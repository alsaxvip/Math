<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NILAI MATEMATIKA</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #4CAF50; /* Example green from a typical school logo */
            --white: #FFFFFF;
            --yellow: #FFC107; /* Example yellow */
            --red: #F44336;
            --light-red: #FFCDD2; /* Lighter red for highlighting */
            --light-grey: #f2f2f2;
            --highlight-blue: #00FFFF;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--light-grey);
            color: #333;
        }

        .container {
            max-width: 1200px; /* Increased max-width for better table display */
            margin: 0 auto;
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header img {
            max-width: 120px;
            height: auto;
            margin-bottom: 15px;
        }

        header h1 {
            color: var(--green);
            margin: 0;
            font-size: 2.2em;
        }

        #login-section {
            text-align: center;
            margin-bottom: 30px;
        }

        #login-section input {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1.1em;
            margin-right: 10px;
        }

        #login-section button {
            background-color: var(--green);
            color: var(--white);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease;
        }

        #login-section button:hover {
            background-color: #45a049; /* Darker green on hover */
        }

        #student-info {
            display: none; /* Hidden by default */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--light-grey);
            border-radius: 5px;
            border-left: 5px solid var(--yellow);
        }

        .info-item strong {
            color: var(--green);
        }

        .info-item span {
            display: block;
            margin-top: 5px;
        }

        .hidden {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 8px; /* Reduced padding for better fit */
            text-align: center;
        }

        table th {
            background-color: var(--green);
            color: var(--white);
            text-transform: uppercase;
            font-size: 0.9em; /* Slightly smaller font for better fit */
        }

        table td {
            font-size: 0.9em;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        .highlight-blue {
            background-color: var(--highlight-blue) !important;
        }

        .highlight-red {
            background-color: var(--light-red) !important;
        }

        #nilai-table-container {
            overflow-x: auto; /* Enable horizontal scrolling for smaller screens */
        }

        #loading {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://iili.io/FqqmPFp.png" alt="Logo Sekolah">
            <h1>NILAI MATEMATIKA</h1>
        </header>

        <section id="login-section">
            <input type="text" id="nisn" placeholder="Masukkan NISN">
            <button onclick="ambilData()">Lihat Nilai</button>
        </section>

        <section id="student-info" class="hidden">
            <div class="info-item"><strong>Nama:</strong> <span id="nama-lengkap"></span></div>
            <div class="info-item"><strong>NISN:</strong> <span id="nisn-info"></span></div>
            <div class="info-item"><strong>Kelas:</strong> <span id="kelas"></span></div>
            <div class="info-item"><strong>Predikat:</strong> <span id="predikat"></span></div>
        </section>

        <section id="nilai-table-container" class="hidden">
            <table id="nilai-table">
                <thead>
                    <tr>
                        <th>NOMOR</th>
                        <th>ASPEK PENILAIAN</th>
                        <th>NILAI</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>1</th>
                        <td>LKS BAB 1</td>
                        <td data-col="3"></td>
                    </tr>
                    <tr>
                        <th>2</th>
                        <td>LKS BAB 2</td>
                        <td data-col="4"></td>
                    </tr>
                    <tr>
                        <th>3</th>
                        <td>LKS BAB 3</td>
                        <td data-col="5"></td>
                    </tr>
                    <tr>
                        <th>4</th>
                        <td>CATATAN TUGAS BAB 1</td>
                        <td data-col="6"></td>
                    </tr>
                    <tr>
                        <th>5</th>
                        <td>CATATAN TUGAS BAB 2</td>
                        <td data-col="7"></td>
                    </tr>
                    <tr>
                        <th>6</th>
                        <td>CATATAN TUGAS BAB 3</td>
                        <td data-col="8"></td>
                    </tr>
                    <tr>
                        <th>7</th>
                        <td>KETERAMPILAN BAB 1</td>
                        <td data-col="9"></td>
                    </tr>
                    <tr>
                        <th>8</th>
                        <td>KETERAMPILAN BAB 2</td>
                        <td data-col="10"></td>
                    </tr>
                    <tr>
                        <th>9</th>
                        <td>KETERAMPILAN BAB 3</td>
                        <td data-col="11"></td>
                    </tr>
                    <tr>
                        <th>10</th>
                        <td>ATS LKS</td>
                        <td data-col="12"></td>
                    </tr>
                    <tr>
                        <th>11</th>
                        <td>ATS ASLI</td>
                        <td data-col="13"></td>
                    </tr>
                    <tr>
                        <th>12</th>
                        <td>ATS PERBAIKAN 25 SOAL</td>
                        <td data-col="14"></td>
                    </tr>
                    <tr>
                        <th>13</th>
                        <td>AAS LKS</td>
                        <td data-col="15"></td>
                    </tr>
                    <tr>
                        <th>14</th>
                        <td>AAS ASLI</td>
                        <td data-col="16"></td>
                    </tr>
                    <tr class="highlight-blue">
                        <th>15</th>
                        <td>PENILAIAN HARIAN</td>
                        <td data-col="17"></td>
                    </tr>
                    <tr class="highlight-blue">
                        <th>16</th>
                        <td>NILAI AKHIR ATS</td>
                        <td data-col="18"></td>
                    </tr>
                    <tr class="highlight-blue">
                        <th>17</th>
                        <td>NILAI AKHIR AAS</td>
                        <td data-col="19"></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <div id="loading" class="hidden">Sedang memuat data...</div>
    </div>

    <script>
        const spreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRs-RK5zrgpKBUJAKD6pCXmLAfqWgHDSyzY9rgAJMFnvzyO-iyyFRlqVKnhUQQlzJp_pPAAbJFQljX_/pub?gid=1829383988&single=true&output=csv'; // Ubah bagian 'edit?gid=...' menjadi 'pub?output=csv'
        const sheetName = 'NILAI2';
        const headerRow = 1;
        const dataStartRow = 2;

        async function ambilData() {
            const nisnInput = document.getElementById('nisn');
            const nisn = nisnInput.value.trim();

            if (!nisn) {
                alert('Silakan masukkan NISN.');
                return;
            }

            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('student-info').classList.add('hidden');
            document.getElementById('nilai-table-container').classList.add('hidden');

            try {
                const response = await fetch(spreadsheetUrl);
                const csvData = await response.text();
                const rows = csvData.split('\n').map(row => row.split(','));

                if (rows.length <= headerRow) {
                    alert('Data spreadsheet tidak valid atau kosong.');
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('login-section').classList.remove('hidden');
                    return;
                }

                const headers = rows[(headerRow - 1)].map(header => header.trim());
                const nisnColumnIndex = headers.indexOf('NISN');
                const namaColumnIndex = headers.indexOf('NAMA LENGKAP');
                const kelasColumnIndex = headers.indexOf('KELAS');
                const predikatColumnIndex = headers.indexOf('PREDIKAT');

                if (nisnColumnIndex === -1 || namaColumnIndex === -1 || kelasColumnIndex === -1 || predikatColumnIndex === -1) {
                    alert('Kolom NISN, NAMA LENGKAP, KELAS, atau PREDIKAT tidak ditemukan di header spreadsheet.');
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('login-section').classList.remove('hidden');
                    return;
                }

                let studentData = null;
                for (let i = dataStartRow - 1; i < rows.length; i++) {
                    if (rows.length > i && rows[(i)] && rows[(i)][nisnColumnIndex] && rows[(i)][nisnColumnIndex].trim() === nisn) {
                        studentData = rows[(i)];
                        break;
                    }
                }

                document.getElementById('loading').classList.add('hidden');

                if (studentData) {
                    document.getElementById('student-info').classList.remove('hidden');
                    document.getElementById('nilai-table-container').classList.remove('hidden');

                    document.getElementById('nama-lengkap').textContent = studentData[(namaColumnIndex)] || '-';
                    document.getElementById('nisn-info').textContent = studentData[(nisnColumnIndex)] || '-';
                    document.getElementById('kelas').textContent = studentData[(kelasColumnIndex)] || '-';
                    document.getElementById('predikat').textContent = studentData[(predikatColumnIndex)] || '-';

                    const nilaiTds = document.querySelectorAll('#nilai-table tbody tr td');
                    nilaiTds.forEach(td => {
                        const colIndex = parseInt(td.dataset.col);
                        if (studentData[(colIndex - 1)] !== undefined) {
                            const nilai = studentData[(colIndex - 1)].trim();
                            if (nilai === '') {
                                td.textContent = '-';
                                td.classList.add('highlight-red');
                            } else {
                                td.textContent = Math.round(parseFloat(nilai));
                                td.classList.remove('highlight-red');
                            }
                        } else {
                            td.textContent = '-';
                            td.classList.add('highlight-red');
                        }
                    });
                } else {
                    alert(`NISN "${nisn}" tidak ditemukan.`);
                    document.getElementById('login-section').classList.remove('hidden');
                }

            } catch (error) {
                console.error('Error fetching or processing data:', error);
                alert('Terjadi kesalahan saat mengambil data.');
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('login-section').classList.remove('hidden');
            }
        }
    </script>
</body>
</html>
