<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NILAI MATEMATIKA</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #4CAF50; /* Example green from a typical school logo */
            --white: #FFFFFF;
            --yellow: #FFC107; /* Example yellow */
            --red: #F44336;
            --light-red: #FFCDD2; /* Lighter red for highlighting */
            --light-grey: #f2f2f2;
            --highlight-blue: #00FFFF;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--light-grey);
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header img {
            max-width: 120px;
            height: auto;
            margin-bottom: 15px;
        }

        header h1 {
            color: var(--green);
            margin: 0;
            font-size: 2.2em;
        }

        #login-section {
            text-align: center;
            margin-bottom: 30px;
        }

        #login-section input {
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1.1em;
            margin-right: 10px;
        }

        #login-section button {
            background-color: var(--green);
            color: var(--white);
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease;
        }

        #login-section button:hover {
            background-color: #45a049;
        }

        /* Styling for student-info section */
        #student-info {
            display: grid; /* Default is grid, will be hidden/shown by JS */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--light-grey);
            border-radius: 5px;
            border-left: 5px solid var(--yellow);
        }

        .info-item strong {
            color: var(--green);
        }

        .info-item span {
            display: block;
            margin-top: 5px;
        }

        .hidden {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        table thead th { /* Only for headers in thead */
            background-color: var(--green);
            color: var(--white);
            text-transform: uppercase;
            font-size: 0.9em;
        }

        table td {
            font-size: 0.9em;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        .highlight-blue {
            background-color: var(--highlight-blue) !important;
        }

        .highlight-red {
            background-color: var(--light-red) !important;
        }

        #nilai-table-container {
            overflow-x: auto;
        }

        #loading {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="https://iili.io/FqqmPFp.png" alt="Logo Sekolah">
            <h1>NILAI MATEMATIKA</h1>
        </header>

        <section id="login-section">
            <input type="text" id="nisn-input" placeholder="Masukkan NISN"> 
            <button onclick="ambilData()">Lihat Nilai</button>
        </section>

        <section id="student-info" class="hidden">
            <div class="info-item"><strong>NAMA LENGKAP : </strong> <span id="nama-lengkap"></span></div>
            <div class="info-item"><strong>NISN : </strong> <span id="nisn-display"></span></div>
            <div class="info-item"><strong>KELAS : </strong> <span id="kelas"></span></div>
            <div class="info-item"><strong>PREDIKAT : </strong> <span id="predikat"></span></div> </section>

        <section id="nilai-table-container" class="hidden">
            <table id="nilai-table">
                <thead>
                    <tr>
                        <th>ASPEK PENILAIAN</th>
                        <th>NILAI</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>LKS BAB 1</td><td data-nilai-row="1"></td></tr>
                    <tr><td>LKS BAB 2</td><td data-nilai-row="2"></td></tr>
                    <tr><td>LKS BAB 3</td><td data-nilai-row="3"></td></tr>
                    <tr><td>CATATAN TUGAS BAB 1</td><td data-nilai-row="4"></td></tr>
                    <tr><td>CATATAN TUGAS BAB 2</td><td data-nilai-row="5"></td></tr>
                    <tr><td>CATATAN TUGAS BAB 3</td><td data-nilai-row="6"></td></tr>
                    <tr><td>KETERAMPILAN BAB 1</td><td data-nilai-row="7"></td></tr>
                    <tr><td>KETERAMPILAN BAB 2</td><td data-nilai-row="8"></td></tr>
                    <tr><td>KETERAMPILAN BAB 3</td><td data-nilai-row="9"></td></tr>
                    <tr><td>ATS LKS</td><td data-nilai-row="10"></td></tr>
                    <tr><td>ATS ASLI</td><td data-nilai-row="11"></td></tr>
                    <tr><td>ATS PERBAIKAN 25 SOAL</td><td data-nilai-row="12"></td></tr>
                    <tr><td>AAS LKS</td><td data-nilai-row="13"></td></tr>
                    <tr><td>AAS ASLI</td><td data-nilai-row="14"></td></tr>
                    <tr class="highlight-blue"><td>PENILAIAN HARIAN</td><td data-nilai-row="15"></td></tr>
                    <tr class="highlight-blue"><td>NILAI AKHIR ATS</td><td data-nilai-row="16"></td></tr>
                    <tr class="highlight-blue"><td>NILAI AKHIR AAS</td><td data-nilai-row="17"></td></tr>
                </tbody>
            </table>
        </section>

        <div id="loading" class="hidden">Sedang memuat data...</div>
    </div>

    <script>
        const spreadsheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRs-RK5zrgpKBUJAKD6pCXmLAfqWgHDSyzY9rgAJMFnvzyO-iyyFRlqVKnhUQQlzJp_pPAAbJFQljX_/pub?gid=1829383988&single=true&output=csv'; // Pastikan ini adalah URL 'publish to web' Anda
        const headerRow = 1; // Baris header berada di baris pertama spreadsheet
        const dataStartRow = 2; // Data dimulai dari baris kedua spreadsheet
        const nilaiColumnStartIndex = 4; // Kolom E adalah indeks 4 (A=0, B=1, C=2, D=3, E=4)
        
        async function ambilData() {
            console.log("Fungsi ambilData() terpanggil!"); // TAMBAHKAN INI
            const nisnInput = document.getElementById('nisn-input');
            
        async function ambilData() {
            const nisnInput = document.getElementById('nisn-input'); // Get value from the new ID
            const nisn = nisnInput.value.trim();

            if (!nisn) {
                alert('Silakan masukkan NISN.');
                return;
            }

            // Sembunyikan semua section dan tampilkan loading
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('student-info').classList.add('hidden'); // Ensure it starts hidden
            document.getElementById('nilai-table-container').classList.add('hidden');

            try {
                const response = await fetch(spreadsheetUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvData = await response.text();
                const rows = csvData.split('\n').filter(row => row.trim() !== '').map(row => row.split(','));

                if (rows.length < headerRow) {
                    alert('Data spreadsheet tidak valid atau kosong.');
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('login-section').classList.remove('hidden');
                    return;
                }

                const headers = rows[headerRow - 1].map(header => header.trim());

                // Pastikan indeks kolom ditemukan
                const nisnColumnIndex = headers.indexOf('NISN');
                const namaColumnIndex = headers.indexOf('NAMA LENGKAP');
                const kelasColumnIndex = headers.indexOf('KELAS');
                const predikatColumnIndex = headers.indexOf('PREDIKAT'); // Match the header name

                if (nisnColumnIndex === -1 || namaColumnIndex === -1 || kelasColumnIndex === -1 || predikatColumnIndex === -1) {
                    alert('Kolom NAMA LENGKAP, NISN, KELAS, atau PREDIKAT tidak ditemukan di header spreadsheet. Pastikan penulisan sesuai.');
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('login-section').classList.remove('hidden');
                    return;
                }

                let studentData = null;
                for (let i = dataStartRow - 1; i < rows.length; i++) {
                    const rowData = rows[i];
                    if (rowData && rowData[nisnColumnIndex] && rowData[nisnColumnIndex].trim() === nisn) {
                        studentData = rowData;
                        break;
                    }
                }

                document.getElementById('loading').classList.add('hidden');

                if (studentData) {
                    // Tampilkan info siswa
                    document.getElementById('student-info').classList.remove('hidden');
                    document.getElementById('nilai-table-container').classList.remove('hidden');

                    document.getElementById('nama-lengkap').textContent = studentData[namaColumnIndex] || '-';
                    document.getElementById('nisn-display').textContent = studentData[nisnColumnIndex] || '-'; // Use the new ID
                    document.getElementById('kelas').textContent = studentData[kelasColumnIndex] || '-';
                    document.getElementById('predikat').textContent = studentData[predikatColumnIndex] || '-'; // Use the new ID

                    // Isi tabel nilai dari kolom E (indeks 4) dan seterusnya
                    const nilaiTds = document.querySelectorAll('#nilai-table tbody td[data-nilai-row]');
                    nilaiTds.forEach(td => {
                        const rowIndexInHTMLTable = parseInt(td.dataset.nilaiRow);
                        
                        // Asumsi: nilai untuk setiap aspek penilaian berurutan dari kolom E ke kanan
                        // LKS BAB 1 ada di kolom E, LKS BAB 2 di kolom F, dst.
                        // Jadi, indeks kolom di spreadsheet adalah nilaiColumnStartIndex (E) + (nomor aspek di tabel HTML - 1)
                        const currentNilaiColumnIndex = nilaiColumnStartIndex + (rowIndexInHTMLTable - 1);
                        
                        const nilai = studentData[currentNilaiColumnIndex];

                        if (nilai !== undefined && nilai.trim() !== '') {
                            td.textContent = Math.round(parseFloat(nilai));
                            td.classList.remove('highlight-red');
                        } else {
                            td.textContent = '-';
                            td.classList.add('highlight-red');
                        }
